<!DOCTYPE html>
<html>

<head>
	<title>Audio Recording</title>
</head>

<body>
	<button id="recordButton">Record</button>
	<button id="stopButton" disabled>Stop</button>
	<div id="audioContainer"></div>
	<button id="sendButton" disabled>Send</button>

	<script>
		const recordButton = document.getElementById('recordButton');
		const stopButton = document.getElementById('stopButton');
		const audioContainer = document.getElementById('audioContainer');
		const sendButton = document.getElementById('sendButton');
		let chunks = [];
		let mediaRecorder;
		let audioElement = null;
		let audioBlob = null;

		navigator.mediaDevices.getUserMedia({ audio: true })
			.then(function (stream) {
				mediaRecorder = new MediaRecorder(stream);

				mediaRecorder.ondataavailable = function (e) {
					chunks.push(e.data);
				};

				mediaRecorder.onstop = function () {
					audioBlob = new Blob(chunks, { type: 'audio/webm' });
					let audioURL = URL.createObjectURL(audioBlob);
					let newAudioElement = document.createElement('audio');
					newAudioElement.controls = true;
					newAudioElement.src = audioURL;
					audioContainer.innerHTML = '';
					audioContainer.appendChild(newAudioElement);
					audioElement = newAudioElement;
					chunks = [];
					sendButton.disabled = false;
				};
			})
			.catch(function (err) {
				console.log('The following error occurred: ' + err);
			});

		recordButton.addEventListener('click', function () {
			recordButton.disabled = true;
			stopButton.disabled = false;
			sendButton.disabled = true;
			chunks = [];
			mediaRecorder.start();
		});

		stopButton.addEventListener('click', function () {
			recordButton.disabled = false;
			stopButton.disabled = true;
			sendButton.disabled = false;
			mediaRecorder.stop();
		});

		sendButton.addEventListener('click', function () {
			if (audioElement) {
				audioElement.src = '';
				audioContainer.innerHTML = '';
				let formData = new FormData();
				formData.append('audio', audioBlob, 'audio.webm');
				console.log(formData.entries())
				
					fetch('/voice', {
					method: 'POST',
					body: formData
					}).then(function (response) {
						console.log(response)
					}).catch(function (error) {
						console.log(error)
					})
				
		
				
			}
		});
	</script>
</body>

</html>